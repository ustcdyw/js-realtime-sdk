!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("leancloud-realtime")):"function"==typeof define&&define.amd?define("groupchat-receipts",["exports","leancloud-realtime"],e):e(t.AV=t.AV||{},t.AV)}(this,function(t,e){"use strict";var n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function o(t,e){return t(e={exports:{}},e.exports),e.exports}var i=o(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),u=o(function(t){var e=t.exports={version:"2.5.5"};"number"==typeof __e&&(__e=e)}),a=(u.version,function(t,e,n){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}}),c=function(t){return"object"==typeof t?null!==t:"function"==typeof t},f=function(t){if(!c(t))throw TypeError(t+" is not an object!");return t},s=function(t){try{return!!t()}catch(t){return!0}},l=!s(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),p=i.document,d=c(p)&&c(p.createElement),y=!l&&!s(function(){return 7!=Object.defineProperty((t="div",d?p.createElement(t):{}),"a",{get:function(){return 7}}).a;var t}),_=Object.defineProperty,m={f:l?Object.defineProperty:function(t,e,n){if(f(t),e=function(t,e){if(!c(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!c(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!c(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!c(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}(e,!0),f(n),y)try{return _(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},h=l?function(t,e,n){return m.f(t,e,function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}(1,n))}:function(t,e,n){return t[e]=n,t},v={}.hasOwnProperty,b=function(t,e){return v.call(t,e)},g=function(t,e,n){var r,o,c,f=t&g.F,s=t&g.G,l=t&g.S,p=t&g.P,d=t&g.B,y=t&g.W,_=s?u:u[e]||(u[e]={}),m=_.prototype,v=s?i:l?i[e]:(i[e]||{}).prototype;for(r in s&&(n=e),n)(o=!f&&v&&void 0!==v[r])&&b(_,r)||(c=o?v[r]:n[r],_[r]=s&&"function"!=typeof v[r]?n[r]:d&&o?a(c,i):y&&v[r]==c?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(c):p&&"function"==typeof c?a(Function.call,c):c,p&&((_.virtual||(_.virtual={}))[r]=c,t&g.R&&m&&!m[r]&&h(m,r,c)))};g.F=1,g.G=2,g.S=4,g.P=8,g.B=16,g.W=32,g.U=64,g.R=128;var w=g;w(w.S+w.F*!l,"Object",{defineProperty:m.f});var O=u.Object,j=function(t,e,n){return O.defineProperty(t,e,n)},M=o(function(t){t.exports={default:j,__esModule:!0}});r(M);var S,P,R=r(o(function(t,e){e.__esModule=!0;var n,r=(n=M)&&n.__esModule?n:{default:n};e.default=function(t,e,n){return e in t?(0,r.default)(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}})),T={}.toString,E=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==function(t){return T.call(t).slice(8,-1)}(t)?t.split(""):Object(t)},x=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t},A=function(t){return E(x(t))},C=Math.ceil,F=Math.floor,I=function(t){return isNaN(t=+t)?0:(t>0?F:C)(t)},k=Math.min,q=Math.max,D=Math.min,G=i["__core-js_shared__"]||(i["__core-js_shared__"]={}),V=0,z=Math.random(),B=G[S="keys"]||(G[S]={}),L=(P=!1,function(t,e,n){var r,o,i=A(t),u=(r=i.length)>0?k(I(r),9007199254740991):0,a=function(t,e){return(t=I(t))<0?q(t+e,0):D(t,e)}(n,u);if(P&&e!=e){for(;u>a;)if((o=i[a++])!=o)return!0}else for(;u>a;a++)if((P||a in i)&&i[a]===e)return P||a||0;return!P&&-1}),N=function(t){return B[t]||(B[t]=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++V+z).toString(36))}(t))}("IE_PROTO"),W="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),K=Object.keys||function(t){return function(t,e){var n,r=A(t),o=0,i=[];for(n in r)n!=N&&b(r,n)&&i.push(n);for(;e.length>o;)b(r,n=e[o++])&&(~L(i,n)||i.push(n));return i}(t,W)},U={f:Object.getOwnPropertySymbols},Y={f:{}.propertyIsEnumerable},H=Object.assign,J=!H||s(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=H({},t)[n]||Object.keys(H({},e)).join("")!=r})?function(t,e){for(var n=Object(x(t)),r=arguments.length,o=1,i=U.f,u=Y.f;r>o;)for(var a,c=E(arguments[o++]),f=i?K(c).concat(i(c)):K(c),s=f.length,l=0;s>l;)u.call(c,a=f[l++])&&(n[a]=c[a]);return n}:H;w(w.S+w.F,"Object",{assign:J});var Q=u.Object.assign,X=r(o(function(t){t.exports={default:Q,__esModule:!0}})),Z=o(function(t,e){!function(e){var n=function(){return"_"}.toString().indexOf("_")>-1,r=function(){},o=Object.prototype.hasOwnProperty,i=Object.create||function(t){var e=function(){};return e.prototype=t,new e},u=Object.keys||function(t){var e=[];for(var n in t)o.call(t,n)&&e.push(n);return e},a=function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);return t},c=Object.prototype.toString,f=Array.isArray||function(t){return"[object Array]"===c.call(t)},s=function(t){return"[object Function]"===c.call(t)},l=function(){},p=!0,d={toString:""};for(var y in d)d.hasOwnProperty(y)&&(p=!1);var _=p?["toString","valueOf"]:null;function m(t,e,r){for(var o,i,a=function(t){var e=u(t);if(p)for(var n,r=0;n=_[r++];)t.hasOwnProperty(n)&&e.push(n);return e}(r),c=0,f=a.length;c<f;)"__self"!==(o=a[c++])&&(i=r[o],!s(i)||i.prototype&&i.prototype.__self||n&&!(i.toString().indexOf(".__base")>-1)?e[o]=i:e[o]=function(n,r){var o=t[n]?t[n]:"__constructor"===n?e.__self.__parent:l,i=function(){var t=this.__base;this.__base=i.__base;var e=r.apply(this,arguments);return this.__base=t,e};return i.__base=o,i}(o,i))}function h(t,e){for(var n,r=1;n=t[r++];)e?s(n)?v.self(e,n.prototype,n):v.self(e,n):e=s(n)?v(t[0],n.prototype,n):v(t[0],n);return e||t[0]}function v(){var t=arguments,e=f(t[0]),n=e||s(t[0]),o=n?e?h(t[0]):t[0]:r,u=t[n?1:0]||{},c=t[n?2:1],l=u.__constructor||n&&o.prototype&&o.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:n?function(){return o.apply(this,arguments)}:function(){};if(!n)return l.prototype=u,l.prototype.__self=l.prototype.constructor=l,a(l,c);a(l,o),l.__parent=o;var p=o.prototype,d=l.prototype=i(p);return d.__self=d.constructor=l,u&&m(p,d,u),c&&m(o,l,c),l}v.self=function(){var t=arguments,e=f(t[0])?h(t[0],t[0][0]):t[0],n=t[1],r=t[2],o=e.prototype;return n&&m(o,o,n),r&&m(e,e,r),e};var b=!0;t.exports=v,b=!1,"object"==typeof modules&&"function"==typeof modules.define&&(modules.define("inherit",function(t){t(v)}),b=!1),b&&(e.inherit=v)}(n)});if(!e.TypedMessage)throw new Error("LeanCloud Realtime SDK not installed");var $=Z(e.TypedMessage,{__constructor:function(t){this.__base(),this.timestamp=new Date(t)}});e.messageType(-101)($),e.messageField(["timestamp"])($),$.sendOptions={transient:!0};var tt={name:"leancloud-realtime-plugin-groupchat-receipts",messageClasses:[$],onIMClientCreate:function(t){var e=t._sendReadCommand;t._sendReadCommand=function(n){for(var r=arguments.length,o=Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return n.forEach(function(t){!t.transient&&t.members.length>2&&t.send(new $(t.lastMessageAt||new Date)).catch(function(t){return console.warn("Sending groupchat receipt fail: "+t.message)})}),e.call.apply(e,[t,n].concat(o))}},onConversationCreate:function(t){var e=t.queryMessages;t.queryMessages=function(){for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return!t.transient&&t.members.length>2&&!t.lastReadTimestamps&&t._fetchAllReceiptTimestamps().then(function(e){t.lastReadTimestamps=e.reduce(function(t,e){var n=e.pid,r=e.lastReadAt;return X(t,R({},n,r))},{}),t.emit("lastreadtimestampsupdate",t.lastReadTimestamps)}).catch(function(t){return console.warn("Initialize group receipts fail: "+t.message)}),e.call.apply(e,[t].concat(r))}},beforeMessageDispatch:function(t,e){return t.type!==$.TYPE||(e.lastReadTimestamps&&(e.lastReadTimestamps[t.from]=t.timestamp,e.emit("lastreadtimestampsupdate",R({},t.from,t.timestamp))),!1)}};t.GroupchatReceiptsPlugin=tt,t.ReadReceipt=$,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=groupchat-receipts.min.js.map
